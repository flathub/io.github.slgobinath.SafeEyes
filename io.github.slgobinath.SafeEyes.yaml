id: io.github.slgobinath.SafeEyes
sdk: org.gnome.Sdk
runtime: org.gnome.Platform
runtime-version: "48"
command: safeeyes

finish-args:
  - "--share=ipc"
  - "--socket=fallback-x11"
  - "--socket=wayland"
  - "--socket=pulseaudio"
  - "--device=dri"
  - "--talk-name=org.mpris.MediaPlayer2.*" # to be able to pause media player on break
  # various DE support
  - "--talk-name=org.gnome.Mutter.IdleMonitor" # smartpause (gnome)
  - "--talk-name=org.kde.StatusNotifierWatcher" # trayicon (all desktops)
  - "--talk-name=org.gnome.SessionManager" # donotdisturb (gnome)
  - "--talk-name=org.gnome.ScreenSaver" # for screensaver plugin (gnome)
  - "--talk-name=org.freedesktop.ScreenSaver" # for screensaver plugin (kde)
  - "--system-talk-name=org.freedesktop.login1" # for swayidle and detecting system suspend

cleanup:
  - /cache
  - /man
  - /share/aclocal
  - /share/devhelp
  - /include
  - /lib/pkgconfig
  - /share/gtk-doc
  - /share/man
  - /lib/*.a
  - /lib/*.la

modules:
  # wlrctl, xprintidle -> manual checks
  - modules/wlrctl.yml # required for 'wayland do not disturb' plugin (x86_64 only)
  - modules/xprintidle.yml # idle detection other than gnome
  - modules/python3-requirements.yml # auto generated pip dependencies for safeeyes
  - modules/swayidle.yml # idle detection for wayland protocol ext-idle-notify-v1

  - name: safeeyes
    buildsystem: simple
    build-commands:
      - cp -r /app/lib/python3.12/site-packages/safeeyes/platform/icons/ /app/share/icons/
      - install -Dm644 /app/lib/python3.12/site-packages/safeeyes/platform/io.github.slgobinath.SafeEyes.desktop /app/share/applications/io.github.slgobinath.SafeEyes.desktop
      - install -Dm644 /app/lib/python3.12/site-packages/safeeyes/platform/io.github.slgobinath.SafeEyes.metainfo.xml /app/share/metainfo/io.github.slgobinath.SafeEyes.metainfo.xml
      - desktop-file-edit --set-key=Exec --set-value=safeeyes /app/share/applications/io.github.slgobinath.SafeEyes.desktop
